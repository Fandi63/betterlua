/*
Template for creating stand-alone EXE files from Lua source
Compile with something like: tcc -B/tcc -I/progs/lua/compiler your_prog.c
*/

#define l_getlocaledecpoint() '.'

#define SQLITE_DEFAULT_FOREIGN_KEYS 1
#define SQLITE_ENABLE_RTREE 1
#define SQLITE_SOUNDEX 1
#define SQLITE_ENABLE_STAT4 1
#define SQLITE_ENABLE_UPDATE_DELETE_LIMIT 1
#define SQLITE_ENABLE_FTS4 1
#define SQLITE_ENABLE_FTS5 1
#define SQLITE_DEFAULT_RECURSIVE_TRIGGERS 1

/* core -- used by all */
#include <lapi.c>
#include <lcode.c>
#include <lctype.c>
#include <ldebug.c>
#include <ldo.c>
#include <ldump.c>
#include <lfunc.c>
#include <lgc.c>
#include <llex.c>
#include <lmem.c>
#include <lobject.c>
#include <lopcodes.c>
#include <lparser.c>
#include <lstate.c>
#include <lstring.c>
#include <ltable.c>
#include <ltm.c>
#include <lundump.c>
#include <lvm.c>
#include <lzio.c>

/* auxiliary library -- used by all */
#include <lauxlib.c>

/* standard library  -- not used by luac */
#include <lbaselib.c>
#if defined(LUA_COMPAT_BITLIB)
#include <lbitlib.c>
#endif
#include <lcorolib.c>
#include <ldblib.c>
#include <liolib.c>
#include <lmathlib.c>
#include <loadlib.c>
#include <loslib.c>
#include <lstrlib.c>
#include <ltablib.c>
#include <lutf8lib.c>
#include <linit.c>

/*
** Create the 'arg' table, which stores all arguments from the
** command line ('argv'). It should be aligned so that, at index 0,
** it has 'argv[script]', which is the script name. The arguments
** to the script (everything after 'script') go to positive indices;
** other arguments (before the script name) go to negative indices.
** If there is no script name, assume interpreter's name as base.
*/
static void createargtable (lua_State *L, char **argv, int argc, int script) {
  int i, narg;
  if (script == argc) script = 0;  /* no script name? */
  narg = argc - (script + 1);  /* number of positive indices */
  lua_createtable(L, narg, script + 1);
  for (i = 0; i < argc; i++) {
    lua_pushstring(L, argv[i]);
    lua_rawseti(L, -2, i - script);
  }
  lua_setglobal(L, "arg");
}

/* Define the script we are going to run */

const char my_prog[] = {

0x1b,0x4c,0x75,0x61,0x53,0x00,0x19,0x93,0x0d,0x0a,0x1a,0x0a,0x04,0x04,0x04,
0x08,0x08,0x78,0x56,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x28,0x77,0x40,0x01,0x0a,0x62,0x65,0x74,0x74,0x65,0x72,0x6c,0x75,0x61,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x02,0x0b,0x00,0x00,0x00,0x2c,
0x00,0x00,0x00,0x08,0x00,0x00,0x80,0x06,0x00,0x40,0x00,0x24,0x40,0x80,0x00,
0x2c,0x40,0x00,0x00,0x08,0x00,0x80,0x80,0x06,0x40,0x40,0x00,0x24,0x40,0x80,
0x00,0x2c,0x80,0x00,0x00,0x08,0x00,0x00,0x81,0x26,0x00,0x80,0x00,0x03,0x00,
0x00,0x00,0x04,0x14,0x63,0x6f,0x6e,0x73,0x6f,0x6c,0x65,0x75,0x74,0x69,0x6c,
0x5f,0x72,0x65,0x71,0x75,0x69,0x72,0x65,0x04,0x12,0x6c,0x6f,0x67,0x69,0x63,
0x75,0x74,0x69,0x6c,0x5f,0x72,0x65,0x71,0x75,0x69,0x72,0x65,0x04,0x12,0x65,
0x78,0x65,0x63,0x75,0x74,0x65,0x5f,0x62,0x65,0x74,0x74,0x65,0x72,0x6c,0x75,
0x61,0x01,0x00,0x00,0x00,0x01,0x00,0x03,0x00,0x00,0x00,0x00,0x06,0x00,0x00,
0x00,0x0b,0x00,0x00,0x00,0x00,0x00,0x02,0x03,0x00,0x00,0x00,0x2c,0x00,0x00,
0x00,0x08,0x00,0x00,0x80,0x26,0x00,0x80,0x00,0x01,0x00,0x00,0x00,0x04,0x04,
0x72,0x75,0x6e,0x01,0x00,0x00,0x00,0x00,0x00,0x01,0x00,0x00,0x00,0x00,0x07,
0x00,0x00,0x00,0x09,0x00,0x00,0x00,0x01,0x00,0x03,0x05,0x00,0x00,0x00,0x46,
0x00,0x40,0x00,0x47,0x40,0xc0,0x00,0x80,0x00,0x00,0x00,0x64,0x40,0x00,0x01,
0x26,0x00,0x80,0x00,0x02,0x00,0x00,0x00,0x04,0x03,0x6f,0x73,0x04,0x08,0x65,
0x78,0x65,0x63,0x75,0x74,0x65,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x05,0x00,0x00,0x00,0x08,0x00,0x00,0x00,0x08,0x00,0x00,0x00,0x08,0x00,
0x00,0x00,0x08,0x00,0x00,0x00,0x09,0x00,0x00,0x00,0x01,0x00,0x00,0x00,0x05,
0x66,0x69,0x6c,0x65,0x00,0x00,0x00,0x00,0x05,0x00,0x00,0x00,0x01,0x00,0x00,
0x00,0x05,0x5f,0x45,0x4e,0x56,0x03,0x00,0x00,0x00,0x09,0x00,0x00,0x00,0x07,
0x00,0x00,0x00,0x0b,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x00,0x00,0x00,
0x05,0x5f,0x45,0x4e,0x56,0x00,0x13,0x00,0x00,0x00,0x2b,0x00,0x00,0x00,0x00,
0x00,0x03,0x0a,0x00,0x00,0x00,0x04,0x00,0x80,0x00,0xac,0x00,0x00,0x00,0x08,
0x80,0x00,0x80,0xac,0x40,0x00,0x00,0x08,0x80,0x80,0x80,0xac,0x80,0x00,0x00,
0x08,0x80,0x00,0x81,0x86,0x80,0x40,0x00,0xa4,0x80,0x80,0x00,0x26,0x00,0x80,
0x00,0x03,0x00,0x00,0x00,0x04,0x07,0x69,0x73,0x5f,0x6e,0x6f,0x74,0x04,0x08,
0x63,0x6f,0x6d,0x70,0x61,0x72,0x65,0x04,0x06,0x69,0x6e,0x70,0x75,0x74,0x01,
0x00,0x00,0x00,0x00,0x00,0x03,0x00,0x00,0x00,0x00,0x17,0x00,0x00,0x00,0x1b,
0x00,0x00,0x00,0x02,0x00,0x03,0x09,0x00,0x00,0x00,0x22,0x00,0x00,0x00,0x1e,
0x40,0x01,0x80,0x86,0x00,0x40,0x00,0x9b,0x00,0x00,0x01,0x1f,0x80,0x80,0x00,
0x1e,0x40,0x00,0x80,0x81,0x40,0x00,0x00,0x89,0x00,0x80,0x00,0x26,0x00,0x80,
0x00,0x02,0x00,0x00,0x00,0x04,0x09,0x72,0x61,0x77,0x65,0x71,0x75,0x61,0x6c,
0x04,0x04,0x79,0x65,0x73,0x02,0x00,0x00,0x00,0x00,0x00,0x01,0x01,0x00,0x00,
0x00,0x00,0x09,0x00,0x00,0x00,0x18,0x00,0x00,0x00,0x18,0x00,0x00,0x00,0x18,
0x00,0x00,0x00,0x18,0x00,0x00,0x00,0x18,0x00,0x00,0x00,0x18,0x00,0x00,0x00,
0x19,0x00,0x00,0x00,0x19,0x00,0x00,0x00,0x1b,0x00,0x00,0x00,0x02,0x00,0x00,
0x00,0x05,0x61,0x72,0x67,0x31,0x00,0x00,0x00,0x00,0x09,0x00,0x00,0x00,0x05,
0x61,0x72,0x67,0x32,0x00,0x00,0x00,0x00,0x09,0x00,0x00,0x00,0x02,0x00,0x00,
0x00,0x05,0x5f,0x45,0x4e,0x56,0x0a,0x6e,0x6f,0x74,0x5f,0x73,0x74,0x61,0x74,
0x65,0x00,0x1d,0x00,0x00,0x00,0x25,0x00,0x00,0x00,0x02,0x00,0x05,0x0e,0x00,
0x00,0x00,0x1f,0x40,0x00,0x00,0x1e,0x40,0x00,0x80,0x81,0x00,0x00,0x00,0x89,
0x00,0x00,0x00,0x86,0x40,0xc0,0x00,0xc0,0x00,0x00,0x00,0x00,0x01,0x80,0x00,
0xa4,0x40,0x80,0x01,0x85,0x00,0x00,0x01,0x1f,0x80,0x40,0x01,0x1e,0x40,0x00,
0x80,0x81,0xc0,0x00,0x00,0x89,0x00,0x00,0x00,0x26,0x00,0x80,0x00,0x04,0x00,
0x00,0x00,0x13,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x04,0x07,0x69,0x73,
0x5f,0x6e,0x6f,0x74,0x04,0x04,0x79,0x65,0x73,0x13,0x01,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x03,0x00,0x00,0x00,0x01,0x00,0x00,0x00,0x01,0x01,0x00,0x00,
0x00,0x00,0x0e,0x00,0x00,0x00,0x1e,0x00,0x00,0x00,0x1e,0x00,0x00,0x00,0x1f,
0x00,0x00,0x00,0x1f,0x00,0x00,0x00,0x21,0x00,0x00,0x00,0x21,0x00,0x00,0x00,
0x21,0x00,0x00,0x00,0x21,0x00,0x00,0x00,0x22,0x00,0x00,0x00,0x22,0x00,0x00,
0x00,0x22,0x00,0x00,0x00,0x23,0x00,0x00,0x00,0x23,0x00,0x00,0x00,0x25,0x00,
0x00,0x00,0x02,0x00,0x00,0x00,0x05,0x61,0x72,0x67,0x31,0x00,0x00,0x00,0x00,
0x0e,0x00,0x00,0x00,0x05,0x61,0x72,0x67,0x32,0x00,0x00,0x00,0x00,0x0e,0x00,
0x00,0x00,0x03,0x00,0x00,0x00,0x07,0x72,0x65,0x73,0x75,0x6c,0x74,0x05,0x5f,
0x45,0x4e,0x56,0x0a,0x6e,0x6f,0x74,0x5f,0x73,0x74,0x61,0x74,0x65,0x00,0x27,
0x00,0x00,0x00,0x29,0x00,0x00,0x00,0x00,0x00,0x02,0x05,0x00,0x00,0x00,0x06,
0x00,0x40,0x00,0x07,0x40,0x40,0x00,0x41,0x80,0x00,0x00,0x24,0x40,0x00,0x01,
0x26,0x00,0x80,0x00,0x03,0x00,0x00,0x00,0x04,0x03,0x6f,0x73,0x04,0x08,0x65,
0x78,0x65,0x63,0x75,0x74,0x65,0x04,0x13,0x70,0x79,0x74,0x68,0x6f,0x6e,0x20,
0x69,0x6e,0x70,0x75,0x74,0x6c,0x69,0x70,0x2e,0x70,0x79,0x01,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x05,0x00,0x00,0x00,0x28,0x00,0x00,0x00,0x28,
0x00,0x00,0x00,0x28,0x00,0x00,0x00,0x28,0x00,0x00,0x00,0x29,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x01,0x00,0x00,0x00,0x05,0x5f,0x45,0x4e,0x56,0x0a,0x00,
0x00,0x00,0x14,0x00,0x00,0x00,0x1b,0x00,0x00,0x00,0x17,0x00,0x00,0x00,0x25,
0x00,0x00,0x00,0x1d,0x00,0x00,0x00,0x29,0x00,0x00,0x00,0x27,0x00,0x00,0x00,
0x2a,0x00,0x00,0x00,0x2a,0x00,0x00,0x00,0x2b,0x00,0x00,0x00,0x03,0x00,0x00,
0x00,0x07,0x72,0x65,0x73,0x75,0x6c,0x74,0x01,0x00,0x00,0x00,0x0a,0x00,0x00,
0x00,0x0a,0x6e,0x6f,0x74,0x5f,0x73,0x74,0x61,0x74,0x65,0x01,0x00,0x00,0x00,
0x0a,0x00,0x00,0x00,0x06,0x69,0x6e,0x70,0x75,0x74,0x09,0x00,0x00,0x00,0x0a,
0x00,0x00,0x00,0x01,0x00,0x00,0x00,0x05,0x5f,0x45,0x4e,0x56,0x00,0x2f,0x00,
0x00,0x00,0x31,0x00,0x00,0x00,0x00,0x00,0x02,0x05,0x00,0x00,0x00,0x06,0x00,
0x40,0x00,0x07,0x40,0x40,0x00,0x41,0x80,0x00,0x00,0x24,0x40,0x00,0x01,0x26,
0x00,0x80,0x00,0x03,0x00,0x00,0x00,0x04,0x03,0x6f,0x73,0x04,0x08,0x65,0x78,
0x65,0x63,0x75,0x74,0x65,0x04,0x25,0x2e,0x2f,0x62,0x69,0x6e,0x2f,0x6c,0x75,
0x61,0x35,0x34,0x2e,0x65,0x78,0x65,0x20,0x2e,0x2f,0x77,0x6f,0x72,0x6b,0x73,
0x70,0x61,0x63,0x65,0x2f,0x6d,0x61,0x69,0x6e,0x2e,0x6c,0x75,0x61,0x01,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x05,0x00,0x00,0x00,0x30,0x00,0x00,
0x00,0x30,0x00,0x00,0x00,0x30,0x00,0x00,0x00,0x30,0x00,0x00,0x00,0x31,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x00,0x00,0x00,0x05,0x5f,0x45,0x4e,0x56,
0x0b,0x00,0x00,0x00,0x0b,0x00,0x00,0x00,0x06,0x00,0x00,0x00,0x0d,0x00,0x00,
0x00,0x0d,0x00,0x00,0x00,0x2b,0x00,0x00,0x00,0x13,0x00,0x00,0x00,0x2d,0x00,
0x00,0x00,0x2d,0x00,0x00,0x00,0x31,0x00,0x00,0x00,0x2f,0x00,0x00,0x00,0x31,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x00,0x00,0x00,0x05,0x5f,0x45,0x4e,
0x56
  };

int
main(int argc, char **argv)
{
  int status, result, i;
  double sum;
  lua_State *L;

  L = luaL_newstate(); /* Create new Lua context */
  luaL_openlibs(L); /* Load Lua libraries */
  createargtable(L, argv, argc, 0);  /* create table 'arg' */

  status = luaL_loadbuffer(L,my_prog,sizeof(my_prog),"betterlua");

  if (status) {
      /* If failed, error message is at the top of the stack */
      fprintf(stderr, "Loading error: %s\n", lua_tostring(L, -1));
      exit(1);
  }

  status = lua_pcall(L, 0, 0, 0);     /* call the loaded chunk */

  if (status) {
      /* If failed, error message is at the top of the stack */
      fprintf(stderr, "Runtime error: %s\n", lua_tostring(L, -1));
      exit(1);
  }

  lua_close(L);   /* Done with Lua */
  return 0;
}

